# Cloud App Devolpment CA

The Movies API is a serverless RESTful application deployed on AWS.
It manages and retrieves information about **movies**, **actors**, **cast members**, and **awards** using a **single-table DynamoDB design**.

The API enforces:

* **Cognito user authentication** for standard users (GET requests).
* **API Key authorization** for administrators (POST/DELETE requests).
* **CloudWatch logging** for both user activity and state changes.

---

## 2. Architecture

```
(placeholder)
```

**AWS Components**

* **API Gateway:** Hosts REST endpoints and manages auth.
* **Lambda:** Executes API logic and stream logging.
* **DynamoDB:** Single table stores all entity types.
* **Cognito:** Manages user sign-up, login, logout.
* **CloudWatch:** Centralized logging of activity and state changes.
* **CDK:** Defines and deploys all infrastructure.

---

## 3. Data Model – Single Table Design

| Entity | Prefix | PK (Partition Key)       | SK (Sort Key)              | Attributes                                          |
| ------ | ------ | ------------------------ | -------------------------- | --------------------------------------------------- |
| Movie  | `m`    | `m:{movieId}`            | `xxxx`                     | `movieId`, `title`, `releaseDate`, `overview`       |
| Actor  | `a`    | `a:{actorId}`            | `xxxx`                     | `actorId`, `name`, `bio`, `dob`                     |
| Cast   | `c`    | `c:{movieId}`            | `{actorId}`                | `movieId`, `actorId`, `roleName`, `roleDescription` |
| Award  | `w`    | `w:{movieId or actorId}` | `{body}#{category}#{year}` | `awardId`, `body`, `category`, `year`               |

---

## 4. REST API Endpoints

| Method     | Endpoint                             | Description                                      | Authorization   |
| ---------- | ------------------------------------ | ------------------------------------------------ | --------------- |
| **GET**    | `/movies/{movieid}`                  | Retrieve a specific movie                        | Cognito User    |
| **GET**    | `/movies/{movieid}/actors`           | Retrieve all actors in a movie                   | Cognito User    |
| **GET**    | `/movies/{movieid}/actors/{actorid}` | Retrieve a cast member                           | Cognito User    |
| **GET**    | `/awards?movie=&actor=&awardBody=`   | Retrieve awards (supports multiple query combos) | Cognito User    |
| **POST**   | `/movies`                            | Add a new movie                                  | Admin (API Key) |
| **DELETE** | `/movies/{movieid}`                  | Delete a movie                                   | Admin (API Key) |

---

## Query parameter logic

| Parameters                      | Result                              |
| ------------------------------- | ----------------------------------- |
| `movie`                         | Awards for that movie               |
| `movie` + `actor`               | Awards for that actor in that movie |
| `movie` + `actor` + `awardBody` | Specific award won                  |
| `movie` + `awardBody`           | Awards for movie by award body      |
| `actor` + `awardBody`           | Awards for actor by body            |
| `awardBody`                     | All awards from that award body     |
| None                            | Returns validation error            |

---

## Authentication and Authorization using Amazon Cognito 

* Users sign up and log in to get a JWT ID token.
* Include token in the header for all GET requests:

  ```
  Authorization: Bearer <ID_TOKEN>
  ```
* API Gateway’s **Cognito Authorizer** validates tokens.

### API Key (Administrator)

* Generated by API Gateway at deployment.
* Required for POST and DELETE requests:

  ```
  x-api-key: <ADMIN_KEY>
  ```

| Role               | Allowed Methods |
| ------------------ | --------------- |
| Authenticated User | GET             |
| Admin (AP          |                 |

